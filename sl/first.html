<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>First Contribution to the Linux Kernel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="row mt-5 justify-content-center">
            <div class="col-md-10 px-5 py-5">
                <h1 class="montserrat-bold pt-5">
                    First Contribution to the Linux Kernel
                </h1>
                <p class="bv mt-3 pt-3">
                    With the proper environment set up, me and Otávio Silva were ready for our first contribution to the Linux Kernel. Professor Paulo Meirelles gathered with Marcelo Schmdit (former IME student that now works with IIO drivers at Analog) and made a list of suggestions of drivers that we could contribute to and of possible improvements to the code. The suggestions involved choosing a driver and applying a correction (or improvement) that was already applied elsewhere. Marcelo ranked the suggestions in order of difficulty. We studied them all, and decided to give it a try at the hardest one. (As you will see in a moment, maybe we were overly confident).
                </p>
                <h2>
                    The Patch
                </h2>
                <p class="bv mt-3">
                    The correction we set out to do involved changing the output of the driver LTC2309, a 12-bit ADC (analog to digital converter). This device converts an analog input into a digital signal. The output is in the form of a 12-bit binary number. Marcelo identified that in some similar devices the output of negative numbers was not always properly represented in 2’s complement form. That means that the negative numbers were not properly indicated to the user. To fix that, some patchs to other drivers used the function sign_extend32() to correct the position of the sign-bit. Our idea was to implement a simliar change but on the driver we were working on.
                </p>
                <p class="bv mt-3">
                    
                    We studied the drivers that implement that change and realized that most of then apply the sign-extension inside the read_raw function - where information is read from the device. We found a very similar structure on the LTC2309 driver and, after reading the device documentation to better understand how it worked, we applied a similar fix.
                    
                </p>
                <h2>
                    The patch reply
                </h2>
                <p>
                    The mantainers were very quick to respond to our patch! But the response was not exactaly what we expected: the mantainers rejected our patch! They warned us that the LTC2309 ADC has to modes of opperation: single-ended mode and differential mode. We did read about that in the documentation before making our patch, but what we didn’t realize is that the single-ended mode does not deal with negative numbers. That means that our patch is not necessary when the device is operating in that mode. In order for our patch to be correct, we must first check which mode the device is using and then decide wheter we need to make the extension or not. If it is in differential mode, than we must apply the extension indeed, but if it is in single-ended mode, than the extension is not necessary.
                </p>
                <p>
                    We now have to correct our patch and send a new version of it!
                </p>
                <h2>
                    Conclusion
                </h2>
                <p>
                    Before making our contribution to the Kernel, we did learn about drivers with the FLUSP tutorials. But we still have a lot to learn! We decided to be more carefull before sending the next patch and our plan is to talk to someone who understands more of the drivers then we do. We have reached out to Marcelo Schmidt in hopes to better understand the driver code before making the next patch. Thankfuflly the mantainer that responded us was very patitent and respectful! We hope that the next patch will be better!
                </p>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>