<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Preparing the environment to build the Kernel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="row mt-5 justify-content-center">
            <div class="col-md-10 px-5 py-5">
                <h1 class="montserrat-bold pt-5">
                    Setting up the environment
                </h1>
                <div class="blog-info">
                    <p class="text-muted mb-1">Posted on April, 2024 by Felipe Aníbal</p>
                    <p class="text-muted mb-1">Last updated on June 24, 2024</p>
                </div>
                <p class="bv mt-3 pt-3">
                    All Linux operating systems (OS) use the linux Kernel, including the Linux Fedora running on my own computer as I write this. If we are going to make changes to the kernel <span class="highlight-green">we must have a way to test our changes while making sure they don't break our system.</span> How can we make changes to the Kernel and test them without risking our own operating system? <span class="highlight-green">We use virtual machines!</span>
                </p>
                <h2>
                    Virtual Machines
                </h2>
                <p class="bv mt-3">
                    The first step to contribute to the kernel was learning about virtual machines and how to set them up. Virtual machines (VM) simulate a computer running inside another computer. <span class="highlight-green">It creates an isolated environment where we can simulate different operating systems, file systems and even different hardware architectures. This allows us to run a linux based OS, and change it to use our modified Kernel. If something breaks along the away, we can delete the broken machine and start another one.</span>
                </p>
                <p class="bv mt-3">
                    In order to setup a virtual machine, we followed <a class="link-opacity-100" href="https://flusp.ime.usp.br/kernel/qemu-libvirt-setup/"> the tutorial made by FLUSP</a>. Most of the process was straight-forward. The only difference is that I used portforwarding to setup the SSH connection to the VM.
                </p>
                <h2>
                    Downloading the Source Code
                </h2>
                <p>
                    The second step was to find the code for the linux Kernel. Many versions of the code are available online, they are called “trees”. For our purposes, since we are going to work with the IIO subsystem (Industrial Input Output), we downloaded the IIO subsystem tree from <a class="link-opacity-100" href="https://git.kernel.org/pub/scm/linux/kernel/git/jic23/iio.git/">this link</a>, following <a class="link-opacity-100" href="https://flusp.ime.usp.br/kernel/build-linux-for-arm/">another tutorial from FLUSP</a>. That part was also straight-forward.
                </p>
                <h2>
                    Building the Kernel
                </h2>
                <p>
                    With the code downloaded, it was time to compile the Kernel. The tutorials we are following were written for an ARM64 architecture, whereas my CPU (and that of most of my classmates) has a X86 architecture. Here we see some of the power of the Virtual Machines. I was only able to follow the tutorials because the virtual machine can simulate a different hardware architecture on my computer. Having set that up it was time to build the Kernel. The process took around 35 minutes on my machine.
                </p>
                <h2>
                    Installing Modules and Booting
                </h2>
                <p>
                    Now that the Kernel and its modules were properly compiled, we had to install the modules and deploy the Kernel on the VM. That involved replacing the old kernel from the VM with the recently downloaded one. To my surprise all steps worked on the first attempt! <span class="highlight-green">For the first time, I built and deployed a Linux Kernel!</span>
                </p>
                <h2>
                    Conclusion
                </h2>
                <p>
                    It was a unique experience to download and build the code from such a big system and one that I use on a daily basis. Next step is to learn how to make changes to the modules and drivers and incorporate these changes to the Kernel on the VM.
                </p>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>